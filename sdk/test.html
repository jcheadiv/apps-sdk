<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	
 
		<head>
<script language="JavaScript" type="text/javascript">
/*<![CDATA[*/
	
function gup(name)
{
	name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
	var regexS = "[\\?&]"+name+"=([^&#]*)";
	var regex = new RegExp( regexS );
	var results = regex.exec( window.location.href );

	if( results == null )
		return "";
	else
		return results[1];
}

var _url_prefix ='http://127.0.0.1:' + gup('port') + '/gui/' ;
var _pair = gup('pair');

function add_torrent(name, size)
{
	tt = document.getElementById('torrentDiv');
	tt.innerHTML += name + ' (' + size + ' bytes)' + "<br/>";
}

function call_jsonp(param, callback)
{
	var previous = document.getElementById('getdata');
	var script = document.createElement('script');

	var src = _url_prefix + '?';
	if (_pair) src += 'token=' + _pair + '&pairing=' + _pair + '&';
	src += param;
	if (callback) src += '&callback=' + callback;
	script.type = 'text/javascript';
	script.id = 'getdata';
	script.src = src;
	var dt = document.getElementById('jsonp');
	dt.replaceChild(script, previous);
}

function on_list(obj)
{
	torrentList = obj['torrents'];
	for (i = 0; i < torrentList.length; ++i)
	{
		add_torrent(torrentList[i][2], torrentList[i][3]);
	}
}

function getlist()
{
	call_jsonp('list=1', 'on_list');
}

function on_addurl(obj)
{
}

function addtorrent(url)
{
	call_jsonp('action=add-url&s=' + escape(url), 'on_addurl');
}

function print_key()
{
	tt = document.getElementById('torrentDiv');
	tt.innerHTML += window.location.href + "<br/>";
}

/*]]>*/
</script>
	</head>
	<body class="frontpage">
		<a href="" onclick="javascript:getlist();return false;">Get torrent list</a>
		<a href="" onclick="javascript:print_key();return false;">print params</a>
		<br/><br/>
		Torrent URL: <input type="text" size="140" id="torrentURL" value="http://www.mininova.org/get/3190508"/><br />
		<a href="" onclick="javascript:addtorrent(document.getElementById('torrentURL').value);return false;">Add torrent</a>
		<br/><br/>

		<div id="torrentDiv"></div>
		<span id="jsonp"><script id="getdata"></script></span>
		
	</body>
</html>
